<div class="collection" data-bind="ownerClass: $data">
    <div class="collectionEditWarning" data-bind="visible: containsEmptyAlerts() && getDraftArticles().value().length > 0">
        Remove this story from the container and press the remove button before sending
        another alert containing the story.
    </div>
    <div class="list-header" data-bind="
        css: {collapsed: state.collapsed() || configMeta.uneditable()}
    ">

        <span class="tools" data-bind="visible: state.hasDraft">
            <a class="draft-warning" data-bind="
                click: front.setModeDraft,
                visible: front.mode() === 'live'">
                <span class="tool draft-warning">Show unlaunched changes</a>

            <span data-bind="
                visible: front.mode() !== 'live' && !containsEmptyAlerts(),
                css: {'pending': isPending()}
            ">

                <a class="tool draft-publish" data-bind="
                    click: publishDraft,
                    text: getPublishText()"></a
                ><a class="tool draft-discard" data-bind="
                    click: discardDraft">Discard</a>
            </span >
        </span>

        <span class="title" data-bind="
            text: getDisplayName()"></span>

        <span data-bind="foreach: configMeta.metadata()">
            <span class="tag-list" data-bind="text: type"></span>
        </span>
        <span class="count" data-bind="if: !isPending() && !configMeta.uneditable()">
            (<span data-bind="
                text: state.count() ? state.count() : 'empty',
                css: {'non-zero':  state.count}"></span>)
        </span>

        <span class="count" data-bind="if: isPending() && !configMeta.uneditable()">
            (<span class="non-zero">updating...</span>)
        </span>

        <span class="collection-is-also-on-other-fronts" data-bind="if: collectionsWhichAreAlsoOnOtherFronts && collectionsWhichAreAlsoOnOtherFronts.length && !displayEditWarning">
            <a class="collectionsWhichAreAlsoOnOtherFrontsToggle" data-bind="click: collectionsWhichAreAlsoOnOtherFrontsToggle">
                <span data-bind="if: !collectionsWhichAreAlsoOnOtherFrontsHasDifferentPriority">Also on&hellip;</span>
                <span data-bind="if: collectionsWhichAreAlsoOnOtherFrontsHasDifferentPriority">
                    <span data-bind="if: collectionsWhichAreAlsoOnOtherFrontsMeritsWarning">
                        Warning: also on
                    </span>
                    <span data-bind="if: !collectionsWhichAreAlsoOnOtherFrontsMeritsWarning">
                        Also on
                    </span>
                    <span data-bind="foreach: collectionsWhichAreAlsoOnOtherFrontsDedupedPriorities">
                        <span data-bind="text: $data" /><span data-bind="if: $index() < $parent.collectionsWhichAreAlsoOnOtherFrontsDedupedPriorities.length - 1">, </span>
                    </span>
                    fronts.
                </span>
            </a>
        </span>
        <span class="collectionEditWarning" data-bind="if: displayEditWarning">
            Warning: do not change or delete the <span data-bind="text: collectionMeta.displayName()"></span> container. Please speak to Central Production.
        </span>

        <span class="list-header__timings" data-bind="
            css: {'has-concurrent-user': state.hasConcurrentEdits}">
            <!-- ko if: state.timeAgo -->
                <span class="list-header__timings__last-updated" data-bind="text: state.timeAgo"></span>
                by <span class="list-header__timings__user" data-bind="text: collectionMeta.updatedBy"></span>
            <!-- /ko -->
            <a data-bind="
                click: reset,
                visible: state.hasConcurrentEdits,
                ">Show edits</a>
        </span>

        <a class="list-header__collapser" data-bind="click: toggleCollapsed">
            <i class="fa" data-bind="css: {
                'fa-chevron-down': !state.collapsed(),
                'fa-chevron-up'  :  state.collapsed }"></i></a>
    </div>

    <div class="collection-is-also-on-other-fronts dropdown" data-bind="
        if: collectionsWhichAreAlsoOnOtherFronts.length,
        css: {'dropdown-open': state.collectionsWhichAreAlsoOnOtherFrontsVisible},
        slideVisible: state.collectionsWhichAreAlsoOnOtherFrontsVisible() && !state.collapsed()
    ">
        <p>
            Warning! This container is shared on other fronts, be careful when editing.
        </p>
        <ul data-bind="foreach: collectionsWhichAreAlsoOnOtherFronts">
            <li><a class="list-header__also-on" data-bind="
                click: $parent.front.setFront,
                text: $data.id"></a>
            </li>
        </ul>
    </div>

    <div class="article-group" data-bind="slideVisible: !state.collapsed()">
        <!-- ko if: state.showIndicators -->
            <div class="desktop-indicator">
                <i class="fa fa-laptop" title="Visible on desktop"></i>
                <div class="indicator" data-bind="
                    indicatorHeight: 'desktop',
                    css: {'hideShowMore': configMeta.hideShowMore},
                    attr: {title: configMeta.hideShowMore() ?
                        'Extra trails will not be visible' :
                        'Extra trails are hidden by \'show more\' button'
                    }
                "></div>
            </div>
            <div class="mobile-indicator">
                <i class="fa fa-mobile" title="Visible on mobile"></i>
                <div class="indicator" data-bind="
                    indicatorHeight: 'mobile',
                    css: {'hideShowMore': configMeta.hideShowMore},
                    attr: {title: configMeta.hideShowMore() ?
                        'Extra trails will not be visible' :
                        'Extra trails are hidden by \'show more\' button'
                    }
                "></div>
            </div>
        <!-- /ko -->

        <!-- ko ifnot: front.flattenGroups -->
        <div data-bind="
                    css: {'pending': isPending()},
                    template: {name: 'template_groups', foreach: groups}"></div>
        <!-- /ko -->
        <!-- ko if: front.flattenGroups() -->
        <div data-bind="
                    css: {'pending': isPending()},
                    template: {name: 'template_groups', data: groups[groups.length - 1]}"></div>
        <!-- /ko -->

    </div>
</div>

<!-- ko if: state.hasExtraActions() && isHistoryEnabled() -->
    <!-- ko if: !state.collapsed() -->
        <hr>

        <div class="buttons">
            <button data-bind="toggleClick: state.isHistoryOpen">
                <span data-bind="text: front.confirmSendingAlert() ? 'History' : 'Recently removed'"></span>
                <!-- ko if: state.isHistoryOpen -->
                    <i class="fa fa-chevron-down"></i>
                <!-- /ko -->
                <!-- ko ifnot: state.isHistoryOpen -->
                    <i class="fa fa-chevron-up"></i>
                <!-- /ko -->
            </button>
        </div>
    <!-- /ko -->

    <div class="history" data-bind="
        slideVisible: state.isHistoryOpen() && !state.collapsed(),
        makeDraggable: true
    ">
        <!-- ko foreach: history -->
            <trail-widget params="context: $context"></trail-widget>
        <!-- /ko -->
    </div>
<!-- /ko -->


<script type="text/html" id="template_groups">
    <!-- ko if: name && !front.flattenGroups() -->
        <div class="group-name" data-bind="text: front.getGroupName(name)"></div>
    <!-- /ko -->
    <div class="droppable" data-bind="
        makeDroppable: true,
        click: pasteItem,
        css: {
            underDrag: underDrag() && !underControlDrag(),
            underControlDrag: underDrag() && underControlDrag()
        }">
            <!-- ko foreach: items -->
                <trail-widget params="context: $context"></trail-widget>
            <!-- /ko -->
            <div class="group-separator" data-bind="css: {'pasteOver': $root.isPasteActive && $root.isPasteActive()}">
                <span class="helptext">Click to paste</span>
            </div>
    </div>
</script>
